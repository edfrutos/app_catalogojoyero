<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Catálogo Joyas (Popup de Imágenes)</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 2rem;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        max-width: 900px;
        margin-top: 2rem;
      }
      th,
      td {
        border: 1px solid #aaa;
        padding: 0.5rem;
        vertical-align: top;
      }
      th {
        background-color: #eee;
      }
      form {
        margin-bottom: 1.5rem;
      }
      /* Ajuste de miniatura */
      .thumbnail {
        max-width: 80px;
        cursor: pointer; /* para indicar que se puede hacer clic */
        margin-top: 0.3rem;
      }

      /* Estilos para el modal (popup) */
      .modal {
        display: none; /* Oculto por defecto */
        position: fixed; /* Posición fija sobre la pantalla */
        z-index: 999; /* Aparece por encima de otros elementos */
        left: 0;
        top: 0;
        width: 100%; /* Ocupa todo el ancho */
        height: 100%; /* Ocupa todo el alto */
        overflow: auto; /* Permite scroll si la imagen es grande */
        background-color: rgba(0, 0, 0, 0.8); /* Fondo semitransparente */
      }

      /* Imagen dentro del modal */
      .modal-content {
        display: block;
        margin: 5% auto;
        max-width: 90%; /* Máximo 90% del viewport */
      }

      /* Botón de cerrar (X) */
      .close {
        position: absolute;
        top: 20px;
        right: 35px;
        color: #fff;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
      }
      .close:hover,
      .close:focus {
        color: #bbb;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <h1>Catálogo Joyas (Popup de Imágenes)</h1>

    <!-- Formulario para agregar nueva fila (sólo ejemplo) -->
    <form method="POST" enctype="multipart/form-data">
      <label for="numero">Número:</label>
      <input type="text" id="numero" name="numero" required />
      <label for="descripcion">Descripción:</label>
      <input type="text" id="descripcion" name="descripcion" required />
      <label for="peso">Peso (gr):</label>
      <input type="number" step="any" id="peso" name="peso" required />
      <label for="valor">Valor:</label>
      <input type="number" step="any" id="valor" name="valor" required />

      <br /><br />
      <label>Imágenes (hasta 3):</label>
      <input type="file" name="imagenes" multiple accept="image/*" />

      <button type="submit">Agregar</button>
    </form>

    <!-- Tabla que muestra los datos leídos del Excel -->
    <table>
      <thead>
        <tr>
          <th>Número</th>
          <th>Descripción</th>
          <th>Peso</th>
          <th>Valor</th>
          <th>Imágenes</th>
          <th>Editar</th>
        </tr>
      </thead>
      <tbody>
        {% for item in data %}
        <tr>
          <td>{{ item.numero }}</td>
          <td>{{ item.descripcion }}</td>
          <td>{{ item.peso }}</td>
          <td>{{ item.valor }}</td>
          <td>
            {% for ruta in item.imagenes %} {% if ruta %}
            <!-- Thumbnail clickable. Al hacer clic, se llama a showModal(ruta) -->
            <img src="{{ '/' + ruta }}" alt="Preview" class="thumbnail" onclick="showModal('{{ '/' + ruta }}')" />
            <br /><br />
            {% endif %} {% endfor %}
          </td>
          <td>
            <a href="/editar/{{ item.numero }}">Editar</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <p>
      <a href="/descargar-excel">Descargar Excel (datos.xlsx)</a>
    </p>

    <!-- El Modal (popup) en sí -->
    <div id="imageModal" class="modal">
      <span class="close" onclick="closeModal()">&times;</span>
      <img class="modal-content" id="modalImage" />
    </div>

    <script>
      // Función que abre el modal y asigna la imagen
      function showModal(imageSrc) {
        var modal = document.getElementById('imageModal');
        var modalImg = document.getElementById('modalImage');

        modal.style.display = 'block';
        modalImg.src = imageSrc;
      }

      // Función que cierra el modal
      function closeModal() {
        var modal = document.getElementById('imageModal');
        modal.style.display = 'none';
      }

      // Cerrar el modal si se hace clic fuera de la imagen
      window.onclick = function (event) {
        var modal = document.getElementById('imageModal');
        if (event.target == modal) {
          closeModal();
        }
      };
    </script>
  </body>
</html>
